<div class="container mt-3">
    <div class="card mb-4">
        <div class="card-header">
            <strong>Agregar Nuevo Cliente</strong>
        </div>
        <div class="card-body">
            <form id="formNuevoCliente" autocomplete="off">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="clienteNombre" required>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Tipo</label>
                        <select class="form-select" id="clienteTipo">
                            <option value="Particular">Particular</option>
                            <option value="Empresa">Empresa</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Teléfono</label>
                        <input type="text" class="form-control" id="clienteTelefono">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="clienteEmail">
                    </div>
                    <div class="col-md-4">
                        <label class="form-label">Dirección</label>
                        <input type="text" class="form-control" id="clienteDireccion">
                    </div>
                </div>
                <div class="mt-3">
                    <button type="submit" class="btn btn-success">
                        <i class="fas fa-plus"></i> Agregar Cliente
                    </button>
                </div>
            </form>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <strong>Lista de Clientes</strong>
        </div>
        <div class="card-body">
            <div id="listaClientes">
                <!-- Aquí se mostrará la lista de clientes -->
            </div>
        </div>
    </div>
</div>
<script>
    // 1. Leer clientes desde localStorage
    function obtenerClientes() {
        return JSON.parse(localStorage.getItem('CLIENTES_PRO')) || [];
    }
    // 2. Guardar clientes en localStorage
    function guardarClientes(clientes) {
        localStorage.setItem('CLIENTES_PRO', JSON.stringify(clientes));
    }
    // 3. Mostrar la lista de clientes en pantalla
    function renderizarListaClientes() {
        const lista = document.getElementById('listaClientes');
        const clientes = obtenerClientes();
        if (clientes.length === 0) {
            lista.innerHTML = '<p class="text-muted">No hay clientes guardados.</p>';
            return;
        }
        lista.innerHTML = '<ul class="list-group mb-2">' +
            clientes.map((c, idx) => `
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <strong>${c.nombre}</strong> (${c.tipo})<br>
                        <small>Tel: ${c.telefono || '-'} | Email: ${c.email || '-'} | Dir: ${c.direccion || '-'}</small>
                    </div>
                    <button class="btn btn-danger btn-sm" onclick="eliminarCliente(${idx})">
                        <i class="fas fa-trash"></i>
                    </button>
                </li>
            `).join('') +
            '</ul>';
    }

    // 4. Evento al guardar nuevo cliente
    document.getElementById('formNuevoCliente').addEventListener('submit', function(e) {
        e.preventDefault(); // ¡Evita recargar o cambiar de tab!
        const nombre = document.getElementById('clienteNombre').value.trim();
        const tipo = document.getElementById('clienteTipo').value;
        const telefono = document.getElementById('clienteTelefono').value.trim();
        const email = document.getElementById('clienteEmail').value.trim();
        const direccion = document.getElementById('clienteDireccion').value.trim();
        if (!nombre) {
            alert("El nombre es obligatorio.");
            return;
        }
        const clientes = obtenerClientes();
        clientes.push({ nombre, tipo, telefono, email, direccion });
        guardarClientes(clientes);
        renderizarListaClientes();
        this.reset();
        // Notifica al cotizador: actualiza el select si existe
        if (window.actualizarSelectClientes) window.actualizarSelectClientes();
    });

    // 5. Eliminar cliente
    window.eliminarCliente = function(idx) {
        if (!confirm("¿Eliminar este cliente?")) return;
        const clientes = obtenerClientes();
        clientes.splice(idx, 1);
        guardarClientes(clientes);
        renderizarListaClientes();
        if (window.actualizarSelectClientes) window.actualizarSelectClientes();
    }

    // 6. Permitir acceso global para otras pestañas
    window.obtenerClientes = obtenerClientes;
    window.actualizarSelectClientes = function() {
        // Si existe el select en cotizaciones, lo llenamos con los clientes
        if (!document.getElementById('clienteSelect')) return;
        const select = document.getElementById('clienteSelect');
        const clientes = obtenerClientes();
        select.innerHTML = '<option value="">Seleccionar cliente...</option>';
        clientes.forEach((cliente, idx) => {
            const texto = `${cliente.nombre} - ${cliente.tipo}`;
            select.innerHTML += `<option value="${idx}">${texto}</option>`;
        });
    }

    // 7. Mostrar lista al cargar
    renderizarListaClientes();
</script>